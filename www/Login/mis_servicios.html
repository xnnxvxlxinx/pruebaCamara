<!DOCTYPE HTML>
<html>
<head>
    <title>Inicio de Sesi&oacute;n</title>
     <meta
  name="viewport"
  content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
   
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/cabeza.css">
    <link rel="stylesheet" type="text/css" href="../archivosbase/CSS/iniciosesion.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/publicacionServicios.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/fotosseleccion.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/ajax-loader.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/mensaje_javascript.css">
	<link rel="stylesheet" type="text/css" href="archivosbase/CSS/productosBuscador.css">
    <link rel="shortcut icon" href="../archivosbase/icons/favicon.ico" />
	<script src="../archivosbase/jquerymobile145/jquery-3.2.1.min.js"></script>
 <script src="../archivosbase/jquerymobile145/jquery.mobile-1.4.5.min.js"></script>
 <script type="text/javascript" src="../cordova.js"></script>
   <script type="text/javascript"  src="../js/phonegap.js"></script>
	<script>
	   var pictureSource;   // picture source
    var destinationType; // sets the format of returned value 
 document.addEventListener("deviceready",onDeviceReady,false);
    // PhoneGap is ready to be used!
    //
    function onDeviceReady() {
	
        pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
    }
    
	var TagPrinciForm=0;
	var InputTitulo='';
var InputDescripcion='';
var InputTagSecundario=[];
var UriImagnes=[];
var TotalImagenes=0;
var InputPrecio=0;
	function initialize() {
	
	$.get("../archivosbase/cabeza.html", function(htmlexterno){
   $("#cabecera").html(htmlexterno);
    	});
		buscarServicios();
		//tagPrincipal();
		}
/*Funcion Cerrar*/
function cerrar(div){		
$("#" + div).fadeOut(150);
}
function buscarServicios(){
 alert('in');
document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){

	document.getElementById('productosBajoMapa').innerHTML='';
	var UID = localStorage.getItem('SesionID') || '<empty>';
	var numeroTagsPrin=0;
	TagPrinciForm=0;
	 InputTitulo='';
 InputDescripcion='';
 InputPrecio=0;
 UriImagnes=[];
 InputTagSecundario=[];
 var contproductosBaj=0;
	   $.getJSON('https://nirjob.com/PhoneGap/servicios/Obtener.php?ID=' + UID, function(data) {  
  alert('in');
		var tamanio=data.length;
			var texto='';
			for(var i=0; i<tamanio; i++){
				var IDOB=data[i].ID;
				var DescripcionOB=data[i].Descripcion;
				var PrecioOB=data[i].Puestos;
				var TagPricipalOB=data[i].TagPri;
				var SecundariosOB=data[i].TagSec;
				var TituloOB=data[i].titulo;
				var ImagenOB=data[i].Imagen;
			var div=document.getElementById('productosBajoMapa');
	var indiv = document.createElement('div');
		indiv.id='productosBajoMapa_' + contproductosBaj;
		indiv.className='productosBajoMapa';
		indiv.style.display='none';
	var texto='<div class="imagenProducto"><img src="https://nirjob.com/' + ImagenOB[0] + '"></div>';
	texto=texto+'<div class="descripcionProducto"><h3><a href="Login/visorServicios.html?ID='+IDOB+'\">' + TituloOB + '</a></h3></div>';
	texto=texto+'<div class="precioProducto"><h3>' + PrecioOB + '</h3></div>';
		div.appendChild(indiv);
		document.getElementById('productosBajoMapa_' + contproductosBaj).innerHTML=texto;
		$("#productosBajoMapa_" + contproductosBaj).fadeIn(250);
		contproductosBaj=contproductosBaj + 1;
			}
		document.getElementById('ajax-loader').style.display='none';	
		});	

		}, 150);
		//tagPrincipal();
}
		var numeroTagsPrin=0;
function tagPrincipal(){

document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){

	document.getElementById('seleccionadorTags').innerHTML='';
	var numeroTagsPrin=0;
	   $.getJSON('https://nirjob.com/PhoneGap/servicios/TagPrincipales.php', function(data) {  
  
		var tamanio=data.length;
			for(var i=0; i<tamanio; i++){
				var ID=data[i].ID;
				var Nombre=data[i].Nombre;
				var Imagen=data[i].Imagen;
			mostrarTags(ID, Nombre, Imagen);
			}
		document.getElementById('ajax-loader').style.display='none';	
		});	

		}, 150);
} 
function ObtenerTagSecundario(ID){
document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){
	   $.getJSON('https://nirjob.com/PhoneGap/servicios/TagSecundarios.php' + '?ID=' + ID, function(data) {  
	var texto='<div><h3>Sub Categorías.</h3>';
		var tamanio=data.length;
			for(var i=0; i<tamanio; i++){
				var ID=data[i].ID;
				var Nombre=data[i].Nombre;
				texto=texto + "<label>"+ Nombre +": <input type='checkbox' value='"+ ID +"' class='InputTagSecundario'/></label><br/><br/><br/>";
			}
			texto=texto + "<input type='submit' value='Siguiente' onclick='seleccionadorImagenes();' style='background-color: #FFD54F;'></div>";
		document.getElementById('seleccionadorTagsSecundarioC').innerHTML=texto;
		document.getElementById('ajax-loader').style.display='none';	
		});	
		}, 150);
}
function mostrarTags(ID, Nombre, Imagen){
var div=document.getElementById('seleccionadorTags');
var indiv = document.createElement('div');
		indiv.id='seleccionadorTags_' + numeroTagsPrin;
		if(TagPrinciForm==ID){
		var texto='<div  onclick="seleccionadorTitulo(\''+ ID +'\')"><img src="https://nirjob.com/'+ Imagen +'" style="background-color:#FFD54F;border-radius: 20px;"/>';
		
		}else{
		var texto='<div  onclick="seleccionadorTitulo(\''+ ID +'\')"><img src="https://nirjob.com/'+ Imagen +'" style="background-color:#1c8ee6;border-radius: 20px;"/>';
		 }
		 texto= texto + '<h3>'+ Nombre +'</h3></div>';
		div.appendChild(indiv);
		document.getElementById('seleccionadorTags_' + numeroTagsPrin).innerHTML=texto;
		numeroTagsPrin=numeroTagsPrin+1;
}

function mostrarTitulo(){

var div=document.getElementById('seleccionadorTituloC');

		var texto='<div ><h3>Título de la Publicación.</h3><input type="text" id="InputTitulo" value="'+ InputTitulo +'" /></br>';
		 texto= texto + '<h3>Descripción de la Publicación.</h3><input type="text" id="InputDescripcion" value="' + InputDescripcion +'" /></br>';
		 texto= texto + '<h3>*Precio $:</h3><input type="number" id="InputPrecio" value="' + InputPrecio +'" /></br>';
		 texto=texto +'<input type="submit" value="Siguiente" onclick="seleccionadorTagsSecundario();" style="background-color: #FFD54F;"></div>';
		
		div.innerHTML=texto;
}
var numeroImagenes=0;
function ObtenerImagenes(){
var div=document.getElementById('seleccionadorImagenesC');
var indiv = document.createElement('div');
		indiv.id='seleccionadorImagenesC_' + numeroImagenes;
		var texto='';
		 texto= texto + '<div class="seleccionadorImagenesC_foto" >';
		 texto= texto + '<img id="seleccionadorImagenesC_IMG'+ numeroImagenes +'" onclick="seleccionFotoImagenI(\'seleccionadorImagenesC_IMG'+ numeroImagenes +'\');" style="width:100%; height:10em;"/></div>';
		div.appendChild(indiv);
		document.getElementById('seleccionadorImagenesC_' + numeroImagenes).innerHTML=texto;
		TotalImagenes=numeroImagenes;
		numeroImagenes=numeroImagenes+1;
}
var fotoImagen='';
function seleccionFotoImagenI(id){

fotoImagen=document.getElementById(id);
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>¿Desea usar la cámara u obtener foto de la galería?</p>";
texto= texto + "<button type='button' onclick='seleccionFotoImagen(1); cerrar(\"mensaje_javascript\");'>Camara</button>";
texto= texto + "<button type='button' onclick='seleccionFotoImagen(2); cerrar(\"mensaje_javascript\");'>Galeria</button>";
		mensaje.childNodes[0].innerHTML=texto;
	}
function seleccionFotoImagen(Num){

if(Num==1){
navigator.camera.getPicture(correcto, error, { quality: 50, allowEdit: false });
//navigator.camera.getPicture(correcto, error, { quality: 200, destinationType: Camera.DestinationType.FILE_URI });
}else{
getPhoto(pictureSource.PHOTOLIBRARY);
}
}
function getPhoto(source) {
      navigator.camera.getPicture(onPhotoURISuccess, error, { quality: 50, 
        destinationType: destinationType.FILE_URI,
        sourceType: source });
    }
function onPhotoURISuccess(imageURI) {
      fotoImagen.src=imageURI;
	  UriImagnes[TotalImagenes]=imageURI;
		//TotalImagenes=TotalImagenes + 1;
    }	
function correcto(rutaImagen){
//console.log(JSON.stringify(rutaImagen));
fotoImagen.src=rutaImagen;
 UriImagnes[TotalImagenes]=rutaImagen;
		//TotalImagenes=TotalImagenes + 1;
}
function error(mensaje){
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Error al tomar la imagen.<br/>Mensaje: " + mensaje + "</p>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Aceptar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}
function seleccionadorTagsSecundario(){
InputTitulo=document.getElementById('InputTitulo').value;
InputDescripcion=document.getElementById('InputDescripcion').value;
InputPrecio=document.getElementById('InputPrecio').value;
if(InputTitulo!='' && InputDescripcion!='' && InputPrecio!='' && InputPrecio>=0){
$("#seleccionadorTitulo").fadeOut(250);
document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){

document.getElementById('seleccionadorTagsSecundarioC').innerHTML='';
ObtenerTagSecundario(TagPrinciForm);
document.getElementById('ajax-loader').style.display='none';	
$("#seleccionadorTagsSecundario").fadeIn(250);
}, 255);
}else{
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>La publicación debe tener un título, una descripción y un precio.<br/>(* Precio=0, A Convenir)</p>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Aceptar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}
}
function seleccionadorImagenes(){
var C=document.getElementsByClassName('InputTagSecundario');
var aux=0;
for(var i=0; i<C.length; i++){
if(C[i].checked==true){
InputTagSecundario[aux]=C[i].value;
aux=aux+1;
}
}
if(aux!=0){
$("#seleccionadorTagsSecundario").fadeOut(250);
document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){
document.getElementById('seleccionadorImagenesC').innerHTML='';
ObtenerImagenes();
document.getElementById('ajax-loader').style.display='none';	
$("#seleccionadorImagenes").fadeIn(250);
}, 255); }else{
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>No ha seleccionado ninguna sub categoría.</p>";
texto= texto + "<button type='button' onclick='seleccionadorImagenes(); cerrar(\"mensaje_javascript\");'>Siguiente</button>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}
}
function seleccionadorTitulo(ID){

$("#seleccionadorTags").fadeOut(250);
document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){
TagPrinciForm=ID;
document.getElementById('seleccionadorTituloC').innerHTML='';
mostrarTitulo();
document.getElementById('ajax-loader').style.display='none';	
$("#seleccionadorTitulo").fadeIn(250);
}, 255);
}
function SubirDatos(){
if(UriImagnes.length==0){
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>No ha seleccionado ninguna Imagen.</p>";
texto= texto + "<button type='button' onclick='SubirDatosF(); cerrar(\"mensaje_javascript\");'>Continuar</button>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}else{
SubirDatosF();
}
}
function SubirDatosF(){
$("#seleccionadorImagenes").fadeOut(250);
document.getElementById('ajax-loader').style.display='block';
setTimeout(function(){
document.getElementById('SubirDatosC').innerHTML='';
subirdatosservicio();
document.getElementById('ajax-loader').style.display='none';	
$("#seleccionadorSubirDatos").fadeIn(250);
}, 255);
}
function regresar(num){
if(num==0){
$("#productosBajoMapa").fadeOut(250);
tagPrincipal();
setTimeout(function(){

$("#seleccionadorTitulo").fadeIn(250);
}, 255);
}
if(num==1){
$("#seleccionadorTitulo").fadeOut(250);
tagPrincipal();
setTimeout(function(){

$("#seleccionadorTags").fadeIn(250);
}, 255);
}
if(num==2){
$("#seleccionadorTagsSecundario").fadeOut(250);
mostrarTitulo();
setTimeout(function(){

$("#seleccionadorTitulo").fadeIn(250);
}, 255);
}
if(num==3){
$("#seleccionadorImagenes").fadeOut(250);
ObtenerTagSecundario(TagPrinciForm);
setTimeout(function(){

$("#seleccionadorTagsSecundario").fadeIn(250);
}, 255);
}
if(num==4){
$("#seleccionadorSubirDatos").fadeOut(250);
setTimeout(function(){

$("#seleccionadorImagenes").fadeIn(250);
}, 255);
}
}
function subirdatosservicio(){

var div=document.getElementById('SubirDatosC');
var texto='<div>';
		var texto='<h3>Título de la Publicación.</h3><input type="text" name="titulo" value="'+ InputTitulo +'" required readonly/></br>';
		 texto= texto + '<h3>Descripción de la Publicación.</h3><input name="descripcion" type="text" required readonly value="' + InputDescripcion +'" /></br>';
texto= texto + '<h3>Valor $:</h3><input name="puestos" type="text"  required readonly value="' + InputPrecio +'" /></br>';		 
		 texto= texto + '<input type="text" name="tag_principal" required readonly value="' +  TagPrinciForm +'" style="display:none"/></br>';
		for(var i=0; i<InputTagSecundario.length; i++){
		 texto= texto + '<input type="text" name="subtag[]" required readonly value="' +  InputTagSecundario[i] +'" style="display:none"/></br>';
		}
		for(var i=0; i<UriImagnes.length; i++){
		 texto= texto + '<h3>Imagen: </h3><div class="seleccionadorImagenesC_foto"><img src="'+ UriImagnes[i] +'" style="width:100%; height:10em;"/></div></br>';
		}
		var UID = localStorage.getItem('SesionID') || '<empty>';
		texto= texto + '<input type="text" name="UID" required readonly value="' +  UID +'" style="display:none"/>';
		texto= texto + '<input type="text" name="tipo" required readonly value="2" style="display:none"/>';
		 texto= texto + '<input type="text" required readonly name="subir_nuevo_oferta_E" value="Subir" style="display:none"/></br>';
		 texto=texto +'<input type="submit"   value="Subir" style="background-color: #FFD54F;"/>';
		 texto=texto +'</form></div>';
		div.innerHTML=texto;
}


$(function(){
        $("#formServicio").on("submit", function(e){
			
            e.preventDefault();
			
            var f = $(this);
            var formData = new FormData(document.getElementById("formServicio"));
			document.getElementById('ajax-loader').style.display='block';
			setTimeout(function(){
            $.ajax({
                url: "https://nirjob.com/PhoneGap/servicios/subirServicio.php",
                type: "post",
                dataType: "json",
                data: formData,
                cache: false,
                contentType: false,
	     processData: false
            }).done(function(data){
				var tamanio=data.length;
				
				if(data[0].Error=='0' && tamanio==1){
				var UID = localStorage.getItem('SesionID') || '<empty>';
	if(UriImagnes.length>0){
	for(var i=0; i<UriImagnes.length; i++){

var win = function(r) {
   var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Se ha subido su pedido de servcio con exito.</p>";
texto= texto + "<button type='button' onclick='location.href=\"../index.html\"; cerrar(\"mensaje_javascript\");'>Continuar</button>";
//texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}

var fail = function(error) {
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Error al enviar su pedido de servcio.</p>";
texto= texto + "<button type='button' onclick='location.href=\"../index.html\"; cerrar(\"mensaje_javascript\");'>Salir</button>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Volvar a intentar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}	
var options = new FileUploadOptions();
options.fileKey = "file";
options.fileName = UriImagnes[i].substr(UriImagnes[i].lastIndexOf('/') + 1);
options.mimeType = "image/jpeg";

var params = {};
params.ID=data[0].ID;
params.UID=UID;
options.params = params;
var ft = new FileTransfer();

ft.upload(UriImagnes[i], encodeURI("https://nirjob.com/PhoneGap/servicios/imagenesSubir.php"), win, fail, options);
}}else{
var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Se ha subido su pedido de servcio con exito.</p>";
texto= texto + "<button type='button' onclick='location.href=\"../index.html\"; cerrar(\"mensaje_javascript\");'>Continuar</button>";
//texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
}			}else{
			var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Error al subir la oferta de servicio.</p>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
				}
			document.getElementById('ajax-loader').style.display='none';
                });
				
				}, 250);
        
		});
		});
 		
	</script>
</head>
<body onload='initialize();'>
    <div id="container">
        <div id="cabecera">

        </div>
		<div id='contenido'>
		<div class='limpiador'></div>
		<div id ='productosBajoMapa'></div>
		<div id='seleccionadorTags' style='display:none'>
		<input type="submit" value="Regresar" onclick='regresar(0);' style="background-color: #FFD54F;">
		
		</div>
		<div class='limpiador'></div>
		<div id='seleccionadorTitulo' style='display:none'>
		<div id='seleccionadorTituloBRegresar' >
		<input type="submit" value="Regresar" onclick='regresar(1);' style="background-color: #FFD54F;">
		</div>
		<div id='seleccionadorTituloC' >
		</div>
		</div>
		<div id='seleccionadorTagsSecundario' style='display:none'>
		<div id='seleccionadorTagsSecundarioBRegresar' >
		<input type="submit" value="Regresar" onclick='regresar(2);' style="background-color: #FFD54F;">
		</div>
		<div id='seleccionadorTagsSecundarioC' >
		</div>
		</div>
		<div id='seleccionadorImagenes' style='display:none'>
		<div id='seleccionadorImagenesBRegresar' >
		<input type="submit" value="Regresar" onclick='regresar(3);' style="background-color: #FFD54F;"></br>
		<input type="submit" value="Nueva Imagen" onclick='ObtenerImagenes();' style="background-color: #FFD54F;">
		</div>
		<div id='seleccionadorImagenesC' >
		</div>
		<input type="submit" value="Siguiente" onclick='SubirDatos();' style="background-color: #FFD54F;">
		</div>
		<div id='seleccionadorSubirDatos' style='display:none'>
		<div id='seleccionadorSubirDatosBRegresar' >
		<input type="submit" value="Regresar" onclick='regresar(4);' style="background-color: #FFD54F;">
		</div>
		<form id="formServicio" method="post" enctype="multipart/form-data">
		<div id='SubirDatosC' >
		</div>
		</form>
		</div>
		</div>
		<div id='footer'>

		</div>
		<div id='ajax-loader'>
	<img src='../archivosbase/img/ajax-loader.gif'/>
	</div>
	<div id='mensaje_javascript'><div></div></div>
    </div>
    </div>
</body>
</html>

