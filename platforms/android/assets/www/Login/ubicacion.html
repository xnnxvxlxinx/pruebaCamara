<!DOCTYPE HTML>
<html>
<head>
    <title>Mi Ubicaci&oacute;n</title>
     <meta
  name="viewport"
  content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
   
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/cabeza.css">
    <link rel="stylesheet" type="text/css" href="../archivosbase/CSS/estilosinlabel.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/publicacionServicios.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/fotosseleccion.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/administrar_usuarios.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/ajax-loader.css">
	<link rel="stylesheet" type="text/css" href="../archivosbase/CSS/mensaje_javascript.css">
    <link rel="shortcut icon" href="../archivosbase/icons/favicon.ico" />
	<script src="../archivosbase/jquerymobile145/jquery-3.2.1.min.js"></script>
 <script src="../archivosbase/jquerymobile145/jquery.mobile-1.4.5.min.js"></script>
 <script type="text/javascript" src="../cordova.js"></script>
   <script type="text/javascript"  src="../js/phonegap.js"></script>
   <script type="text/javascript" 
    src="https://maps.google.com/maps/api/js?sensor=false&key=AIzaSyDfGxUMXZLtPNZzXgJ1xioFvsJranjPkiU"> 
</script> 
	<script>
	var UID = localStorage.getItem('SesionID') || '<empty>';
	 var gpsenabled=0;
function cerrar(div){		
$("#" + div).fadeOut(150);
}
	function initialize() {
	
	$.get("../archivosbase/cabeza.html", function(htmlexterno){
   $("#cabecera").html(htmlexterno);
    	});
document.getElementById('inputUID').value=UID;
cordova.plugins.diagnostic.isLocationEnabled(function(enabled){
//alert(enabled);
if(enabled==true){
gpsenabled=1;
}
else{
gpsenabled=0;
			}
			}, function(error){alert(error);});
	ObtenerSucursales();
	}
	function ObtenerSucursales(){
	
	document.getElementById('ajax-loader').style.display='block';
	setTimeout(function(){	   
	   $.getJSON('https://nirjob.com/PhoneGap/ubicacion/locales.php?ID=' + UID, function(data) {  
		var tamanio=data.length;
		for(var i=0; i<tamanio; i++){
		if(data[i].ERROR=='0'){
		latitud=parseFloat(data[i].latitud);
		longitud=parseFloat(data[i].longitud);
		direccion=data[i].direccion;
		UbiId=data[i].UbiId;
			construir(latitud, longitud, direccion, UbiId);
		}
		if(data[0].ERROR=='1'){
		alert('ERROR: 404');
		}
		}
		document.getElementById('ajax-loader').style.display='none';	
		});	
	
		}, 150);
		
	
	}
	var inputLatitud='';
	var inputLongitud='';
	var nL=0;
	function construir(latitud, longitud, direccion, UbiId){
	//alert("Latutud: " + latitud + "Longitud: " + longitud);
	var div=document.getElementById('InputsC');
var indiv = document.createElement('div');
		indiv.id='DIVUBI_' + nL;
	var texto="";
	texto=texto + "<input style='display:none' type='text' class='coordEdit' name='latitud[]' value='"+ latitud +"' id='latitud_mapa_"+ nL +"' required readonly>";
	texto=texto + "<input style='display:none' type='text' class='coordEdit' value='"+ longitud +"' id='longitud_mapa_"+ nL +"' name='longitud[]' required readonly>";
texto=texto + "Direcci&oacute;n: <input type='text'class='coordEdit' name='direccion[]' value='"+ direccion +"' required></br>";
texto=texto + "<input type='text' required readonly name='id_editar_ubicacion[]' value='"+ UbiId +"' style='display:none;' />";
texto=texto + "<button type='button' class='botonUbi' onclick='aplastado(this); obtenerUbicacion("+ latitud +", "+ longitud +",\"latitud_mapa_"+ nL +"\",\"longitud_mapa_"+ nL +"\")' style='margin-left: 2%;'>Ubicar</button>";
texto=texto + "<button type='button' class='cancelar_edit' onclick='EliminarUbicacion(\""+ UbiId +"\");'></button><br/>";
				div.appendChild(indiv);
		indiv.innerHTML=texto;	
		nL=nL+1;
	}
function nuevo(){
	var div=document.getElementById('InputsC');
var indiv = document.createElement('div');
		indiv.id='DIVUBI_' + nL;
	var texto="";
	texto=texto + "<input style='display:none' type='text' class='coordEdit' name='latitud[]' value='' id='latitud_mapa_"+ nL +"' required readonly>";
	texto=texto + "<input style='display:none' type='text' class='coordEdit' value='' id='longitud_mapa_"+ nL +"' name='longitud[]' required readonly>";
texto=texto + "Direcci&oacute;n: <input type='text'class='coordEdit' name='direccion[]' value='' required></br>";
if(gpsenabled==1){
texto=texto + "<button type='button' class='botonUbi' onclick='aplastado(this);gps(\"latitud_mapa_"+ nL +"\",\"longitud_mapa_"+ nL +"\");' style='margin-left: 2%;'>Ubicaci&oacute;n Por GPS</button>";
}
texto=texto + "<button type='button' class='botonUbi' onclick='aplastado(this); obtenerUbicacion(-0.1574824, -78.4682946 ,\"latitud_mapa_"+ nL +"\",\"longitud_mapa_"+ nL +"\")' style='margin-left: 2%;'>Ubicaci&oacute;n Predeterminada</button>";
texto=texto + "<button type='button' class='cancelar_edit' onclick='EliminarDiv(\"DIVUBI_"+ nL +"\");'></button><br/>";
				div.appendChild(indiv);
		indiv.innerHTML=texto;	
		nL=nL+1;	
	}
	function EliminarDiv(div1){
	var div = document.getElementById(div1);
    if(div !== null){
        while (div.hasChildNodes()){
            div.removeChild(div.lastChild);
        }
    }else{
        alert ('ERROR');
    }
	}
	function aplastado(e){
	var x=document.getElementsByClassName('botonUbi');
	for(var i=0; i<x.length; i++){
	x[i].style.backgroundColor='red';
	}
	e.style.backgroundColor='blue';
	}
	
var onSuccess = function(position) {
       /* alert('Latitude: '          + position.coords.latitude          + '\n' +
              'Longitude: '         + position.coords.longitude         + '\n');*/
    obtenerUbicacion(position.coords.latitude, position.coords.longitude, inputLatitud, inputLongitud);
	};

  var onError = function(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
function gps(lat, lon){
inputLatitud=lat;
inputLongitud=lon;
navigator.geolocation.getCurrentPosition(onSuccess, onError);
}	
function getCoords(marker, inoutLat, inputLon)
					{ 
				document.getElementById(inoutLat).value=marker.getPosition().lat(); 
				document.getElementById(inputLon).value=marker.getPosition().lng(); 
					} 
				var contadorubicaciones=1;
function obtenerUbicacion(lat,lon, inoutLat, inputLon) {	
				
				var myLatlng = new google.maps.LatLng(lat,lon); 
				document.getElementById('mapa').style.display='block';
				var myOptions = { 
				zoom: 16, 
        center: myLatlng, 
        mapTypeId: google.maps.MapTypeId.ROADMAP, 
    } 
    var map = new google.maps.Map(document.getElementById('mapaC'), myOptions); 
   marker = new google.maps.Marker({ 
          position: myLatlng, 
          draggable: true, 
          title:'Donde?' 
    });
	
    google.maps.event.addListener(marker, 'dragend', function() { 
                    getCoords(marker, inoutLat, inputLon); 
    }); 
     
      marker.setMap(map); 
    getCoords(marker, inoutLat, inputLon); 
  }	
$(function(){
        $("#formUbicacion").on("submit", function(e){
            e.preventDefault();
            var f = $(this);
            var formData = new FormData(document.getElementById("formUbicacion"));
			document.getElementById('ajax-loader').style.display='block';
			setTimeout(function(){
            $.ajax({
                url: "https://nirjob.com/PhoneGap/ubicacion/SubirE.php",
                type: "post",
                dataType: "json",
                data: formData,
                cache: false,
                contentType: false,
	     processData: false
            }).done(function(data){
				var tamanio=data.length;
			
				if(data[0].Error=='0' && tamanio==1){
				
				var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Exito al subir sus Ubicaciones.</p>";
texto= texto + "<button type='button' onclick='location.href=\"../index.html\";'>Aceptar</button>";
		mensaje.childNodes[0].innerHTML=texto;
			}else{
			var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Error al subir sus Ubicaciones.</p>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
				}
			document.getElementById('ajax-loader').style.display='none';
                });
				
				}, 250);
        
		});
		});
		function EliminarUbicacion(id){
			document.getElementById('mensaje_javascript').style.display='block';
		$.get('https://nirjob.com/PhoneGap/ubicacion/borrarUbicacionE.php?IDmen=' + id, function(texto){
			
			document.getElementById('mensaje_javascript').childNodes[0].innerHTML=texto;
		});
		}
		function borrarBotonF(){
      /*  $("#BorrarHorariosForm").on("submit", function(e){
            e.preventDefault();*/
            var f = $(this);
            var formData = new FormData(document.getElementById("BorrarHorariosForm"));
			document.getElementById('ajax-loader').style.display='block';
			setTimeout(function(){
            $.ajax({
                url: "https://nirjob.com/PhoneGap/ubicacion/borrarUbicacionF.php",
                type: "post",
                dataType: "json",
                data: formData,
                cache: false,
                contentType: false,
	     processData: false
            }).done(function(data){
				var tamanio=data.length;
			
				if(data[0].Error=='0' && tamanio==1){
				
				var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Exito al Borrar su Ubicaci&oacute;n.</p>";
texto= texto + "<button type='button' onclick='location.href=\"../index.html\";'>Aceptar</button>";
		mensaje.childNodes[0].innerHTML=texto;
			}else{
			var mensaje=document.getElementById('mensaje_javascript');
		mensaje.style.display='block';
var texto="<p>Error al Borrar su Ubicaci&oacute;n.</p>";
texto= texto + "<button type='button' onclick='cerrar(\"mensaje_javascript\")'>Regresar</button>";
		mensaje.childNodes[0].innerHTML=texto;
				}
			document.getElementById('ajax-loader').style.display='none';
                });
				
				}, 250);
        
		/*});*/
		}	
	</script>
</head>
<body onload='initialize();'>
    <div id="container">
        <div id="cabecera">
        </div>
		<div id='contenido'>
		<div class='limpiador'></div>
		<div id='seleccionadorSubirDatos'>
		<form id="formUbicacion" method="post" enctype="multipart/form-data">
		<div id='SubirDatosC' >
		<div id='InputsC'>
		</div>
		<div id='mapa' style='width:100%; height:20em; display:none;'>
		<div id='mapaC' style='width:90%; height:20em; margin-left:5%;'>
		</div>
		</div>
		<div>
		<input name='UID' value='' required readonly style='display:none' type='text' id='inputUID' />
		<button type='button' onclick='nuevo();'>Nueva Localizaci&oacute;n</button>
		<input id='InputDescriEnviar' type='submit' value='Subir' />
		</div>
		</div>
		</form>
		

		</div>
		 </div>
		<div id='footer'>

		</div>
		<div id='ajax-loader'>
	<img src='../archivosbase/img/ajax-loader.gif'/>
	</div>
	<div id='mensaje_javascript'><div></div></div>
    </div>
</body>
</html>

